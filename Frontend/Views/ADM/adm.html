<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Funcionários - IMPERIUM</title>

  <!-- Bootstrap CSS & Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>
<script>
const API_URL = "http://localhost:8080/api/usuarios/listar";

async function loadUsuarios() {
    const tbody = document.getElementById("usuarioTableBody");
    tbody.innerHTML = ""; // clear table

    try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Falha ao carregar usuários");
        const data = await res.json();

        data.forEach(u => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${u.id}</td><td>${u.login}</td>`;
            tbody.appendChild(tr);
        });
    } catch (err) {
        alert("Erro ao carregar usuários");
        console.error(err);
    }
}

// call on page load
window.addEventListener("DOMContentLoaded", loadUsuarios);
</script>
<body>

<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
  <div class="container-fluid">
    <a class="navbar-brand" href="#" onclick="navigateTo('list')">IMPERIUM</a>
    <div class="collapse navbar-collapse">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item me-2">
          <button class="btn btn-light btn-sm" onclick="navigateTo('list')">Equipe</button>
        </li>
        <li class="nav-item">
          <button class="btn btn-success btn-sm" onclick="navigateTo('add')">Cadastrar Funcionário</button>
        </li>
      </ul>
    </div>
  </div>
</nav>

<div class="container mt-4">

  <!-- LIST VIEW -->
  <table class="table table-bordered">
    <thead>
        <tr>
            <th>ID</th>
            <th>Login</th>
        </tr>
    </thead>
    <tbody id="usuarioTableBody">
    </tbody>
  </table>

  <!-- ADD VIEW -->
  <section id="view-add" class="view d-none">
    <div>
      <h2>Cadastrar Funcionário</h2>
      <form id="formAdd" class="mt-3" onsubmit="submitAdd(event)">
        <div class="mb-3">
          <label for="addNome" class="form-label">Nome</label>
          <input type="text" id="addNome" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="addEmail" class="form-label">Email</label>
          <input type="email" id="addEmail" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="addTelefone" class="form-label">Telefone</label>
          <input type="text" id="addTelefone" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="addSenha" class="form-label">Senha</label>
          <input type="password" id="addSenha" class="form-control" required>
        </div>
        <div class="mb-3">
          <label for="addCargo" class="form-label">Cargo</label>
          <select id="addCargo" class="form-control" required>
            <option value="relacionamento">Relacionamento</option>
            <option value="recrutamento">Recrutamento</option>
            <option value="vendas">Vendas</option>
            <option value="admin">Administrador</option>
          </select>
        </div>

        <button class="btn btn-success">Cadastrar</button>
        <button type="button" class="btn btn-secondary" onclick="navigateTo('list')">Cancelar</button>
      </form>
    </div>
  </section>

</div> <!-- /container -->

<!-- Bootstrap bundle -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Simple navigation for SPA
function navigateTo(view) {
  document.querySelectorAll('.view').forEach(v => v.classList.add('d-none'));
  if(view === 'list') {
    document.querySelector('table').classList.remove('d-none');
  } else if(view === 'add') {
    document.getElementById('view-add').classList.remove('d-none');
  }
}

// Fetch users and populate table
async function loadUsuarios() {
  try {
    const res = await fetch(API_URL);
    if(!res.ok) throw new Error("Erro ao buscar usuários");
    const usuarios = await res.json();
    const tbody = document.getElementById("usuarioTableBody");
    tbody.innerHTML = "";

    usuarios.forEach(u => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.id}</td>
        <td>${u.login}</td>
      `;
      tbody.appendChild(tr);
    });
  } catch(err) {
    console.error(err);
    const tbody = document.getElementById("usuarioTableBody");
    tbody.innerHTML = `<tr><td colspan="2">Erro ao carregar usuários</td></tr>`;
  }
}


// Load users on page load
window.addEventListener("DOMContentLoaded", loadUsuarios);
</script>

</body>
</html>
